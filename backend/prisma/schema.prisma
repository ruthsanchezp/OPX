model Client {
  client_id      Int            @id @default(autoincrement())
  first_name     String         @db.VarChar(100)
  last_name      String?        @db.VarChar(100)
  agreement_type String?        @db.VarChar(50)
  id_fiscal      String         @unique @db.VarChar(50)
  phone          String?        @db.VarChar(20)
  email          String?        @db.VarChar(100)
  address        String?        @db.VarChar(255)
  city           String?        @db.VarChar(100)
  birth_date     DateTime?
  created_at     DateTime       @default(now())

  medicalOrders  MedicalOrder[] @relation(onDelete: Cascade)  // ðŸ”¹ Elimina Ã³rdenes al borrar el cliente
}
model MedicalOrder {
  order_id      Int      @id @default(autoincrement())
  client_id     Int
  created_by    Int
  reviewed_by   Int?
  created_at    DateTime @default(now())

  observaciones String?   @db.Text
  cristales     String?   @db.VarChar(255)

  client        Client    @relation(fields: [client_id], references: [client_id], onDelete: Cascade) 
  createdBy     User      @relation("UserCreatedOrders", fields: [created_by], references: [id], onDelete: Cascade)  // ðŸ”¹ Se eliminan Ã³rdenes con el usuario
  reviewedBy    User?     @relation("UserReviewedOrders", fields: [reviewed_by], references: [id], onDelete: Cascade)  // ðŸ”¹ Se eliminan Ã³rdenes revisadas con el usuario

  graduations   Graduation[]       @relation(onDelete: Cascade)  
  graduationsNear GraduationNear[] @relation(onDelete: Cascade)  
}

model Graduation {
  graduation_id Int     @id @default(autoincrement())
  order_id      Int
  eye           String  @db.VarChar(10)
  SPH           Float?
  CYL           Float?
  EJE           Float?
  DP            Float?
  created_at    DateTime @default(now())

  medicalOrder  MedicalOrder @relation(fields: [order_id], references: [order_id], onDelete: Cascade)  // ðŸ”¹ Se eliminan al borrar la orden
}

model GraduationNear {
  graduation_near_id Int     @id @default(autoincrement())
  order_id           Int
  eye               String  @db.VarChar(10)
  SPH               Float?
  CYL               Float?
  EJE               Float?
  DP                Float?
  created_at        DateTime @default(now())

  medicalOrder      MedicalOrder @relation(fields: [order_id], references: [order_id], onDelete: Cascade)  // ðŸ”¹ Se eliminan al borrar la orden
}
